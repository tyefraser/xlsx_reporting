Checking worksheet: Summary
Tables found: {}
Checking worksheet: Datasets_1
Tables found: {'Table1_customer_list': <openpyxl.worksheet.table.Table object>
Parameters:
id=1, name='Table1_customer_list', displayName='Table1_customer_list', comment=None, ref='B4:E10', tableType=None, headerRowCount=1, insertRow=None, insertRowShift=None, totalsRowCount=None, totalsRowShown=False, published=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowBorderDxfId=None, tableBorderDxfId=None, totalsRowBorderDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, connectionId=None, autoFilter=<openpyxl.worksheet.filters.AutoFilter object>
Parameters:
ref='B4:E10', filterColumn=[], sortState=None, sortState=None, tableColumns=[<openpyxl.worksheet.table.TableColumn object>    
Parameters:
id=1, uniqueName=None, name='First Name', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=2, uniqueName=None, name='Last Name', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=3, uniqueName=None, name='Start_date', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=1, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=4, uniqueName=None, name='Purchases', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=0, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None], tableStyleInfo=<openpyxl.worksheet.table.TableStyleInfo object>
Parameters:
name='TableStyleMedium2', showFirstColumn=False, showLastColumn=False, showRowStripes=True, showColumnStripes=False, 'Table2_items': <openpyxl.worksheet.table.Table object>
Parameters:
id=2, name='Table2_items', displayName='Table2_items', comment=None, ref='B13:E16', tableType=None, headerRowCount=1, insertRow=None, insertRowShift=None, totalsRowCount=None, totalsRowShown=False, published=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowBorderDxfId=None, tableBorderDxfId=None, totalsRowBorderDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, connectionId=None, autoFilter=<openpyxl.worksheet.filters.AutoFilter object>
Parameters:
ref='B13:E16', filterColumn=[], sortState=None, sortState=None, tableColumns=[<openpyxl.worksheet.table.TableColumn object>   
Parameters:
id=1, uniqueName=None, name='Item name', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=2, uniqueName=None, name='purchases', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=3, uniqueName=None, name='cost', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=2, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=4, uniqueName=None, name='sales price', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=3, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None], tableStyleInfo=<openpyxl.worksheet.table.TableStyleInfo object>
Parameters:
name='TableStyleMedium2', showFirstColumn=False, showLastColumn=False, showRowStripes=True, showColumnStripes=False}
Processing table: Table1_customer_list
Processing table: Table2_items
Checking worksheet: Datasets_2
Tables found: {'Table3_locations': <openpyxl.worksheet.table.Table object>
Parameters:
id=4, name='Table3_locations', displayName='Table3_locations', comment=None, ref='B3:D6', tableType=None, headerRowCount=1, insertRow=None, insertRowShift=None, totalsRowCount=None, totalsRowShown=False, published=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowBorderDxfId=None, tableBorderDxfId=None, totalsRowBorderDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, connectionId=None, autoFilter=<openpyxl.worksheet.filters.AutoFilter object>   
Parameters:
ref='B3:D6', filterColumn=[], sortState=None, sortState=None, tableColumns=[<openpyxl.worksheet.table.TableColumn object>     
Parameters:
id=1, uniqueName=None, name='Country', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=2, uniqueName=None, name='State', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=3, uniqueName=None, name='Suburb', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None], tableStyleInfo=<openpyxl.worksheet.table.TableStyleInfo object>
Parameters:
name='TableStyleMedium2', showFirstColumn=False, showLastColumn=False, showRowStripes=True, showColumnStripes=False, 'Table4_employees': <openpyxl.worksheet.table.Table object>
Parameters:
id=5, name='Table4_employees', displayName='Table4_employees', comment=None, ref='B9:D12', tableType=None, headerRowCount=1, insertRow=None, insertRowShift=None, totalsRowCount=None, totalsRowShown=False, published=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowBorderDxfId=None, tableBorderDxfId=None, totalsRowBorderDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, connectionId=None, autoFilter=<openpyxl.worksheet.filters.AutoFilter object>  
Parameters:
ref='B9:D12', filterColumn=[], sortState=None, sortState=None, tableColumns=[<openpyxl.worksheet.table.TableColumn object>    
Parameters:
id=1, uniqueName=None, name='First Name', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=2, uniqueName=None, name='Last Name', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=3, uniqueName=None, name='Id', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None], tableStyleInfo=<openpyxl.worksheet.table.TableStyleInfo object>
Parameters:
name='TableStyleMedium2', showFirstColumn=False, showLastColumn=False, showRowStripes=True, showColumnStripes=False}
Processing table: Table3_locations
Processing table: Table4_employees
Empty DataFrame
Columns: []
Index: []




Checking worksheet: Datasets_1
<openpyxl.worksheet.table.Table object>
Parameters:
id=1, name='Table1_customer_list', displayName='Table1_customer_list', comment=None, ref='B4:E10', tableType=None, headerRowCount=1, insertRow=None, insertRowShift=None, totalsRowCount=None, totalsRowShown=False, published=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowBorderDxfId=None, tableBorderDxfId=None, totalsRowBorderDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, connectionId=None, autoFilter=<openpyxl.worksheet.filters.AutoFilter object>

Parameters:
ref='B4:E10', filterColumn=[], sortState=None, sortState=None, tableColumns=[<openpyxl.worksheet.table.TableColumn object>
Parameters:
id=1, uniqueName=None, name='First Name', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=2, uniqueName=None, name='Last Name', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=None, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=3, uniqueName=None, name='Start_date', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=1, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None, <openpyxl.worksheet.table.TableColumn object>
Parameters:
id=4, uniqueName=None, name='Purchases', totalsRowFunction=None, totalsRowLabel=None, queryTableFieldId=None, headerRowDxfId=None, dataDxfId=0, totalsRowDxfId=None, headerRowCellStyle=None, dataCellStyle=None, totalsRowCellStyle=None, calculatedColumnFormula=None, totalsRowFormula=None, xmlColumnPr=None, extLst=None], tableStyleInfo=<openpyxl.worksheet.table.TableStyleInfo object>
Parameters:
name='TableStyleMedium2', showFirstColumn=False, showLastColumn=False, showRowStripes=True, showColumnStripes=False




for sheet in wb.worksheets:
        for table_name, table_ref in sheet.tables.items():  # Iterate over tables
            
            table_obj = sheet.tables[table_name]
            print(table_obj.name)

            if table_obj.name == table_name:
                print(f"Altering: {table_obj.name}")
                start_cell, end_cell = table_obj.ref.split(":")  # e.g., "B4:E10"
                start_col, start_row = start_cell[0], int(start_cell[1:])
                end_col, end_row = end_cell[0], int(end_cell[1:])
                
                num_columns = ord(end_col) - ord(start_col) + 1  # Number of columns
                table_header_row = start_row  # Table headers should remain
                first_data_row = start_row + 1  # First row of actual data

                # ðŸ›‘ **STEP 1: DELETE ALL DATA ROWS (LEAVE HEADER)**
                sheet.delete_rows(first_data_row, end_row - start_row)  # Remove all rows except headers
                
                # ðŸŸ¢ **STEP 2: LEAVE ONE EMPTY ROW FOR EXCEL TO RETAIN TABLE**
                # for col_idx in range(num_columns):
                #     cell_ref = f"{chr(ord(start_col) + col_idx)}{first_data_row}"
                #     sheet[cell_ref] = None  # Set an empty row
                
                # # ðŸŸ¢ **STEP 3: ADD NEW DATA BELOW HEADER**
                # for row_idx, row_data in enumerate(new_data):
                #     for col_idx, value in enumerate(row_data):
                #         cell_ref = f"{chr(ord(start_col) + col_idx)}{first_data_row + row_idx}"
                #         sheet[cell_ref] = value
                
                # âœ… **STEP 4: Update Table Range in Excel**
                # new_end_row = first_data_row + len(new_data) - 1
                # table.ref = f"{start_col}{start_row}:{end_col}{new_end_row}"

                print(f"âœ… Replaced data in table: {table_name}")
                break  # Exit loop after finding the table

    wb.save(file_path)




































# def replace_table_data(file_path, table_name, new_data):
def replace_table_data(
        file_path
        , table_name = "Table1_customer_list" # to remove and use yaml later
):
    """Replaces data inside a given Excel table."""

    # # Get table_details for the file
    # wb, table_details = get_excel_table_details(file_path)

    # # Confirm that the requested table exists in the file
    # if table_name.isin(table_details["table_name"]):
    #     # Log info this is okay
    #     print("test")
    # else:
    #     # Log error and raise error
    #     print("test")
    
    # # Get the sheet name that has the table required
    # sheet_name = table_details[table_details["table_name"] == table_name]["sheet_name"].iloc[0]
    # ws = wb[sheet_name]

    # sheet_table_details = table_details[table_details["sheet_name"] == sheet_name]
    # table_start_row_number = sheet_table_details[sheet_table_details["table_name"] == table_name]["start_row_number"].iloc[0]
    # table_start_row_number_data = table_start_row_number + 1
    # table_end_row_number = sheet_table_details[sheet_table_details["table_name"] == table_name]["end_row_number"].iloc[0]

    # DELETE ALL DATA ROWS (LEAVE HEADER)
    rows_removed = table_end_row_number - table_start_row_number
    logger.info(f"Removing {rows_removed} rows from sheet.")
    ws.delete_rows(table_start_row_number_data, rows_removed)  # Remove all rows except headers

    # Update table references
    sheet_table_details[sheet_table_details["table_name"] == table_name]["end_row_number"] = sheet_table_details[sheet_table_details["table_name"] == table_name]["end_row_number"] - rows_removed

    # Update all table after the modified table
    sheet_table_details[sheet_table_details["start_row_number"] > table_start_row_number]["start_row_number"] = (
        sheet_table_details[sheet_table_details["start_row_number"] > table_start_row_number]["start_row_number"]  - rows_removed
    )
    sheet_table_details[sheet_table_details["start_row_number"] > table_start_row_number]["end_row_number"] = (
        sheet_table_details[sheet_table_details["start_row_number"] > table_start_row_number]["end_row_number"]  - rows_removed
    )



    # Add in new data to table
    print(sheet_table_details)

    # Refresh underlying table data in xlsx
    for _, table in table_details.iterrows():
        table_name = table["table_name"]
        row_start = table["start_row_number"]
        row_end = table["end_row_number"]
        col_start = table["start_col_number"]
        col_end = table["end_col_number"]

        tbl_ref = (
            get_column_letter(col_start) +
            row_start + ":" +
            get_column_letter(col_end) +
            row_end
        )
        print(f"tbl_ref: {tbl_ref}")
        table_obj = ws.tables[table_name]
        print(f"Table object: {table_obj}")

        ws.tables[table_name].ref = tbl_ref

    wb.save(file_path)

    # ðŸŸ¢ **STEP 2: LEAVE ONE EMPTY ROW FOR EXCEL TO RETAIN TABLE**
    # for col_idx in range(num_columns):
    #     cell_ref = f"{chr(ord(start_col) + col_idx)}{first_data_row}"
    #     sheet[cell_ref] = None  # Set an empty row
    
    # # ðŸŸ¢ **STEP 3: ADD NEW DATA BELOW HEADER**
    # for row_idx, row_data in enumerate(new_data):
    #     for col_idx, value in enumerate(row_data):
    #         cell_ref = f"{chr(ord(start_col) + col_idx)}{first_data_row + row_idx}"
    #         sheet[cell_ref] = value
    
    # âœ… **STEP 4: Update Table Range in Excel**
    # new_end_row = first_data_row + len(new_data) - 1
    # table.ref = f"{start_col}{start_row}:{end_col}{new_end_row}"

    # print(f"âœ… Replaced data in table: {table_name}")
    # break  # Exit loop after finding the table

    



            # print(name)
            # print(table)
            # if table.displayName == table_name:
                # start_cell = table.ref.split(":")[0]  # e.g., "B4"
                # col_letter = start_cell[0]  # Get column letter (e.g., "B")
                # start_row = int(start_cell[1:])  # Get row number (e.g., 4)

                # # Clear existing table data (excluding headers)
                # for row in range(start_row + 1, start_row + len(new_data) + 1):
                #     for col_idx in range(len(new_data[0])):
                #         sheet[f"{chr(ord(col_letter) + col_idx)}{row}"].value = None
                
                # # Insert new data
                # for row_idx, row_data in enumerate(new_data):
                #     for col_idx, value in enumerate(row_data):
                #         cell_ref = f"{chr(ord(col_letter) + col_idx)}{start_row + 1 + row_idx}"
                #         sheet[cell_ref] = value
                
                # print(f"âœ… Replaced data in table: {table_name}")
                # break









